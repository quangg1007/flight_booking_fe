<div class="flex justify-between gap-8 px-20 py-10 mx-auto">
  <!-- Left side - Booking Form -->
  <div class="w-2/3">
    <ul class="steps steps-vertical lg:steps-horizontal w-full mb-8">
      <li class="step" [ngClass]="{ 'step-primary': currentStep >= 1 }">
        Personal Information
      </li>
      <li class="step" [ngClass]="{ 'step-primary': currentStep >= 2 }">
        Travel Document
      </li>
      <li class="step" [ngClass]="{ 'step-primary': currentStep >= 3 }">
        Contact Information
      </li>
    </ul>

    <form [formGroup]="bookingForm">
      <!-- Step 1: Personal Information -->
      <div *ngIf="currentStep === 1">
        <div class="form-control">
          <label class="label">First Name</label>
          <input
            type="text"
            formControlName="firstName"
            class="input input-bordered"
          />
        </div>
        <div class="form-control">
          <label class="label">Last Name</label>
          <input
            type="text"
            formControlName="lastName"
            class="input input-bordered"
          />
        </div>
        <div class="form-control">
          <label class="label">Date of Birth</label>
          <input
            type="date"
            formControlName="dateOfBirth"
            class="input input-bordered"
          />
        </div>
        <div class="form-control">
          <label class="label">Gender</label>
          <select formControlName="gender" class="select select-bordered">
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>

      <!-- Step 2: Travel Document -->
      <div *ngIf="currentStep === 2">
        <div class="form-control">
          <label class="label">Passport Number</label>
          <input
            type="text"
            formControlName="passportNumber"
            class="input input-bordered"
          />
        </div>
        <div class="form-control">
          <label class="label">Passport Expiry Date</label>
          <input
            type="date"
            formControlName="passportExpiry"
            class="input input-bordered"
          />
        </div>
        <div class="form-control">
          <label class="label">Nationality</label>
          <input
            type="text"
            formControlName="nationality"
            class="input input-bordered"
          />
        </div>
      </div>

      <!-- Step 3: Contact Information -->
      <div *ngIf="currentStep === 3">
        <div class="form-control">
          <label class="label">Street Address</label>
          <input
            type="text"
            formControlName="address"
            class="input input-bordered"
          />
        </div>
        <div class="form-control">
          <label class="label">City</label>
          <input
            type="text"
            formControlName="city"
            class="input input-bordered"
          />
        </div>
        <div class="form-control">
          <label class="label">Country</label>
          <input
            type="text"
            formControlName="country"
            class="input input-bordered"
          />
        </div>
        <div class="form-control">
          <label class="label">Postal Code</label>
          <input
            type="text"
            formControlName="postalCode"
            class="input input-bordered"
          />
        </div>
      </div>

      <!-- Navigation Buttons -->
      <div
        class="flex mt-4"
        [ngClass]="currentStep === 1 ? 'justify-end' : 'justify-between'"
      >
        <button class="btn" *ngIf="currentStep > 1" (click)="previousStep()">
          Previous
        </button>
        <button
          class="btn btn-primary"
          *ngIf="currentStep < 3"
          (click)="nextStep()"
          [disabled]="!isCurrentStepValid()"
        >
          Next
        </button>

        <button
          class="btn btn-primary"
          *ngIf="currentStep === 3"
          (click)="openConfirmDialog()"
        >
          Submit
        </button>

        <dialog id="my_modal_1" class="modal">
          <div class="modal-box w-5/6 max-w-xl">
            <h3 class="font-bold text-lg">Confirm Booking</h3>
            <ng-container
              *ngTemplateOutlet="confirmBookingTemplate"
            ></ng-container>
          </div>
        </dialog>
      </div>
    </form>
    <div *ngIf="isAuth && recentPassengers.length > 0" class="mt-8">
      <h3 class="text-lg font-bold mb-4">Recent Passengers</h3>
      <div class="grid grid-cols-3 gap-4">
        <div
          *ngFor="let passenger of recentPassengers.slice(0, 3)"
          class="card bg-base-200 cursor-pointer hover:bg-base-300"
          (click)="selectPassenger(passenger)"
        >
          <div class="card-body">
            <h4 class="card-title">
              {{ passenger.first_name }} {{ passenger.last_name }}
            </h4>
            <p>Passport: {{ passenger.passport_number }}</p>
            <p>Nationality: {{ passenger.nationality }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add this after the form -->

  <!-- Right side - Login -->
  <div class="w-1/3">
    <div class="timer-display">Time remaining: {{ timeRemainingDisplay }}</div>
    @if (isAuth) {
    <div class="card bg-base-200">
      <div class="card-body">
        <h2 class="card-title">Already have an account</h2>
      </div>
    </div>
    }@else {
    <div class="card bg-base-200">
      <div class="card-body">
        <h2 class="card-title">Already have an account?</h2>
        <p>Login to auto-fill your information</p>
        <app-login (isAuthChanged)="routeToBookingForm()"></app-login>
      </div>
    </div>
    }
  </div>
</div>

<ng-template #confirmBookingTemplate>
  <p>Would you like to proceed with this booking?</p>
  <div class="modal-action">
    <button class="btn btn-primary" (click)="confirmBooking()">Confirm</button>
    <button class="btn" (click)="closeDialog()">Cancel</button>
  </div>
</ng-template>

<dialog class="modal" id="timeoutModal">
  <div class="modal-box">
    <h3 class="font-bold text-lg">Session Timeout</h3>
    <p>
      Your booking session has expired. Please search again for fresh flight
      data.
    </p>
    <div class="modal-action flex justify-end">
      <button class="btn btn-primary" (click)="redirectToSearch()">
        Return to Search
      </button>
    </div>
  </div>
</dialog>
